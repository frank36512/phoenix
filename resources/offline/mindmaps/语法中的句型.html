<!DOCTYPE html>
<html style="height: 100%">
<head>
    <meta charset="utf-8">
    <title>Mindmap</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
</head>
<body style="height: 100%; margin: 0; background-color: #f0f2ff; font-family: 'Microsoft YaHei', sans-serif;">
    <div id="container" style="height: 100%"></div>
    <script type="text/javascript">
        var dom = document.getElementById('container');
        var myChart = echarts.init(dom);
        var app = {};
        
        var option = {"backgroundColor": "#f0f2ff", "tooltip": {"trigger": "item", "triggerOn": "mousemove"}, "toolbox": {"show": true, "feature": {"saveAsImage": {"show": true, "title": "保存图片", "pixelRatio": 2}, "restore": {"show": true, "title": "恢复"}}}, "series": [{"type": "tree", "symbolSize": 9, "edgeShape": "curve", "roam": true, "lineStyle": {"color": "#ccc", "curveness": 0.5, "width": 2}, "label": {"position": "left", "verticalAlign": "middle", "align": "right", "fontSize": 16, "color": "#1f2937", "fontFamily": "Microsoft YaHei"}, "leaves": {"label": {"position": "right", "verticalAlign": "middle", "align": "left"}}, "emphasis": {"focus": "descendant"}, "expandAndCollapse": true, "animationDuration": 550, "animationDurationUpdate": 750, "initialTreeDepth": 2, "data": [{"name": "语法中的句\n型", "children": [{"name": "概述", "children": [{"name": "要点1", "children": [], "type": "list", "value": 1, "itemStyle": {"color": "#7B8D8E", "borderColor": "#7B8D8E"}, "lineStyle": {"color": "#ccc"}, "full_name": "要点1"}, {"name": "要点2", "children": [], "type": "list", "value": 1, "itemStyle": {"color": "#7B8D8E", "borderColor": "#7B8D8E"}, "lineStyle": {"color": "#ccc"}, "full_name": "要点2"}, {"name": "要点3", "children": [], "type": "list", "value": 1, "itemStyle": {"color": "#7B8D8E", "borderColor": "#7B8D8E"}, "lineStyle": {"color": "#ccc"}, "full_name": "要点3"}], "type": "header", "value": 3, "itemStyle": {"color": "#7B8D8E", "borderColor": "#7B8D8E"}, "lineStyle": {"color": "#ccc"}, "full_name": "概述"}], "type": "header", "value": 3, "itemStyle": {"color": "#7B8D8E", "borderColor": "#7B8D8E"}, "lineStyle": {"color": "#ccc"}, "full_name": "语法中的句型", "symbolSize": 1, "label": {"show": true, "rotate": 0, "fontSize": 22, "fontWeight": "bold", "color": "#fff", "backgroundColor": "#7B8D8E", "padding": [12, 16], "borderRadius": 6, "shadowBlur": 10, "shadowColor": "rgba(0,0,0,0.2)", "position": "inside"}}], "left": "50%", "right": "20%", "orient": "LR"}, {"type": "tree", "symbolSize": 9, "edgeShape": "curve", "roam": true, "lineStyle": {"color": "#ccc", "curveness": 0.5, "width": 2}, "label": {"position": "right", "verticalAlign": "middle", "align": "left", "fontSize": 16, "color": "#1f2937", "fontFamily": "Microsoft YaHei"}, "leaves": {"label": {"position": "left", "verticalAlign": "middle", "align": "right"}}, "emphasis": {"focus": "descendant"}, "expandAndCollapse": true, "animationDuration": 550, "animationDurationUpdate": 750, "initialTreeDepth": 2, "data": [{"name": "语法中的句\n型", "children": [], "type": "header", "value": 3, "itemStyle": {"color": "#7B8D8E", "borderColor": "#7B8D8E"}, "lineStyle": {"color": "#ccc"}, "full_name": "语法中的句型", "symbolSize": 0, "label": {"show": false}}], "left": "20%", "right": "50%", "orient": "RL"}]};
        
        // Inject tooltip formatter for full text display
        option.tooltip = option.tooltip || {};
        option.tooltip.formatter = function(params) {
            var data = params.data || {};
            var content = data.full_name || params.name;
            if (params.value && !isNaN(params.value)) {
                 content += ': ' + params.value;
            }
            return content ? content.replace(/\n/g, '<br/>') : '';
        };
        
        // Add edgeLabel formatter function (cannot be passed via JSON)
        if (option.series) {
            option.series.forEach(function(s) {
                if (s.type === 'tree') {
                    s.edgeLabel = {
                        show: true,
                        formatter: function (params) {
                            return params.data.edge_label || '';
                        },
                        fontSize: 10,
                        color: '#666',
                        backgroundColor: 'white',
                        padding: [2, 4],
                        borderRadius: 4
                    };
                }
            });
        }

        if (option && typeof option === 'object') {
            myChart.setOption(option);
        }
        
        window.addEventListener('resize', myChart.resize);

        // Support for slow motion recording
        window.startSlowMotionAnimation = function(speedRatio) {
            // Get base duration (default 1000ms if not set)
            var baseDuration = 1000;
            if (option.series && option.series[0]) {
                baseDuration = option.series[0].animationDuration || 1000;
            }
            
            // Calculate slowed down duration
            var newDuration = baseDuration / speedRatio;
            
            console.log("Starting slow motion animation. Base:", baseDuration, "New:", newDuration);
            
            // Update all series
            var newSeries = [];
            if (option.series) {
                option.series.forEach(function(s) {
                    newSeries.push({
                        animationDuration: newDuration,
                        animationDurationUpdate: newDuration
                    });
                });
            }
            
            // Update chart
            myChart.setOption({
                series: newSeries
            });
            
            // Restart animation by clearing and resetting
            myChart.clear();
            myChart.setOption(option);
            
            return { totalDuration: newDuration };
        };
    </script>
</body>
</html>